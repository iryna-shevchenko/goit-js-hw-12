{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\n// import { handleFormSubmit } from './js/pixabay-api';\n// import { renderImages, reateImageCard } from './js/render-functions';\n\nconst API_KEY = '44479541-afd008fbdfda4a6c986ece69f';\nconst searchFormElement = document.querySelector('.search-form');\nconst galleryElement = document.querySelector('.gallery');\nconst lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nconst loaderElement = document.querySelector('.loader');\nconst loadMoreButton = document.querySelector('.load-more');\nlet currentPage = 1;\nlet totalHits = 0;\nlet searchQuery = '';\nlet imagesLoaded = 0;\n\nloaderElement.style.display = 'none';\nloadMoreButton.classList.remove('visible');\n\nsearchFormElement.addEventListener('submit', handleFormSubmit);\nloadMoreButton.addEventListener('click', loadMoreImages);\n\nasync function handleFormSubmit(event) {\n  event.preventDefault();\n  searchQuery = event.target.querySelector('.search-input').value.trim();\n\n  if (!searchQuery) {\n    iziToast.warning({\n      title: 'Warning!',\n      message: 'Please enter image name!',\n      position: 'topRight',\n    });\n    return;\n  }\n\n  clearGallery();\n  showLoader();\n  hideLoadMoreButton();\n\n  try {\n    const response = await axios.get('https://pixabay.com/api/', {\n      params: {\n        key: API_KEY,\n        q: searchQuery,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        page: currentPage,\n        per_page: 40,\n      },\n    });\n\n    hideLoader();\n\n    const data = response.data;\n\n    if (data.hits.length === 0) {\n      iziToast.error({\n        message:\n          'Sorry, there are no images matching your search query. Please try again!',\n        position: 'topRight',\n      });\n      return;\n    }\n\n    totalHits = data.totalHits;\n    imagesLoaded = data.hits.length;\n    renderImages(data.hits);\n    lightbox.refresh();\n\n    iziToast.info({\n      message: `We found ${totalHits} images.`,\n      position: 'topRight',\n    });\n\n    if (totalHits > 15) {\n      showLoadMoreButton();\n    }\n  } catch (error) {\n    console.error('Error fetching images:', error);\n    hideLoader();\n    iziToast.error({\n      message: 'Failed to fetch images. Please try again later.',\n      position: 'topRight',\n    });\n  }\n}\n\nfunction renderImages(images) {\n  const fragment = document.createDocumentFragment();\n\n  images.forEach(image => {\n    const imageCardElement = createImageCard(image);\n    fragment.appendChild(imageCardElement);\n  });\n\n  galleryElement.appendChild(fragment);\n}\n\nfunction createImageCard(image) {\n  const imageCardElement = document.createElement('div');\n  imageCardElement.classList.add('card');\n\n  imageCardElement.innerHTML = `\n    <a class=\"gallery-link\" href=\"${image.largeImageURL}\">\n      <img class=\"card-image\" src=\"${image.webformatURL}\" alt=\"${image.tags}\" loading=\"lazy\">\n    </a>\n    <div class=\"card-info\">\n      <p class=\"card-text\"><b>Likes:</b> ${image.likes}</p>\n      <p class=\"card-text\"><b>Views:</b> ${image.views}</p>\n      <p class=\"card-text\"><b>Comments:</b> ${image.comments}</p>\n      <p class=\"card-text\"><b>Downloads:</b> ${image.downloads}</p>\n    </div>\n  `;\n\n  return imageCardElement;\n}\n\nfunction clearGallery() {\n  galleryElement.innerHTML = '';\n  currentPage = 1;\n  hideLoadMoreButton();\n}\n\nasync function loadMoreImages() {\n  showLoader();\n  hideLoadMoreButton();\n\n  try {\n    const response = await axios.get('https://pixabay.com/api/', {\n      params: {\n        key: API_KEY,\n        q: searchQuery,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        page: currentPage + 1,\n        per_page: 15,\n      },\n    });\n\n    hideLoader();\n\n    const data = response.data;\n\n    if (data.hits.length === 0) {\n      return;\n    }\n\n    currentPage++;\n\n    if (imagesLoaded + data.hits.length > totalHits) {\n      data.hits = data.hits.slice(0, totalHits - imagesLoaded);\n    }\n\n    imagesLoaded += data.hits.length;\n\n    renderImages(data.hits);\n    lightbox.refresh();\n\n    if (imagesLoaded >= totalHits) {\n      hideLoadMoreButton();\n      iziToast.info({\n        message: `We're sorry, but you've reached the end of search results.`,\n        position: 'topRight',\n      });\n    } else {\n      showLoadMoreButton();\n    }\n\n    const cards = document.querySelectorAll('.card');\n    const newImages = Array.from(cards).slice(-15);\n    if (newImages.length > 0) {\n      const firstNewImage = newImages[0];\n\n      firstNewImage.scrollIntoView({\n        behavior: 'smooth',\n        block: 'start',\n      });\n    }\n  } catch (error) {\n    console.error('Error fetching more images:', error);\n    hideLoader();\n    iziToast.error({\n      message: 'Failed to fetch more images. Please try again later.',\n      position: 'topRight',\n    });\n  }\n}\n\nfunction showLoader() {\n  loaderElement.style.display = 'block';\n}\n\nfunction hideLoader() {\n  loaderElement.style.display = 'none';\n}\n\nfunction showLoadMoreButton() {\n  loadMoreButton.style.display = 'block';\n}\n\nfunction hideLoadMoreButton() {\n  loadMoreButton.style.display = 'none';\n}"],"names":["API_KEY","searchFormElement","galleryElement","lightbox","SimpleLightbox","loaderElement","loadMoreButton","currentPage","totalHits","searchQuery","imagesLoaded","handleFormSubmit","loadMoreImages","event","iziToast","clearGallery","showLoader","hideLoadMoreButton","response","axios","hideLoader","data","renderImages","showLoadMoreButton","error","images","fragment","image","imageCardElement","createImageCard","cards","newImages"],"mappings":"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"}